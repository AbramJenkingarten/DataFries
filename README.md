# DataFries
```
Подготовка данных к обработке нейросетью.
Источником данных служит OrderLog в формате Plaza2.
OrderLog получается из распаковки записаной торговой сессии в формате qsh в формат txt.
```
# Формат: 0Received;1ExchTime;2OrderId;3Price;4Amount;5AmountRest;6DealId;7DealPrice;8OI;9Flags
```
0Received - время отправки заявки
1ExchTime - время принятия заявки шлюзом
2OrderId - номер заявки
3Price - цена в заявке
4Amount - количество в заявке
5AmountRest - оставшееся количество в заявке
6DealId - номер сделки
7DealPrice - цена сделки
8OI - 
9Flags - значения в uint16
набор битовых флагов, характеризующих данную операцию в соответствии со спецификацией Plaza II:
бит 0 – при получении данной записи поле ReplAct не было равно нулю (NonZeroReplAct);
бит 1 – данная запись получена с новым идентификатором сессии или после сообщения смены номера жизни потока (FlowStart);
бит 2 – новая заявка (Add);
бит 3 – заявка сведена в сделку (Fill);
бит 4 – покупка (Buy);
бит 5 – продажа (Sell);
бит 6 – запись получена из архива торговой системы (Snapshot);
бит 7 – котировочная (Quote);
бит 8 – встречная (Counter);
бит 9 – внесистемная (NonSystem);
бит 10 – запись является последней в транзакции (EndOfTransaction);
бит 11 – заявка fill-or-kill (FillOrKill);
бит 12 – запись является результатом операции перемещения заявки (Moved);
бит 13 – запись является результатом операции удаления заявки (Canceled);
бит 14 – запись является результатом группового удаления (CanceledGroup);
бит 15 – признак удаления остатка заявки по причине кросс-сделки (CrossTrade).
```

# http://ftp.moex.com/pub/ClientsAPI/Spectra/CGate/docs/
# file:p2gate_ru_6_1_2018.pdf page:21
Заявка — это приказ участника торгов в торговую систему на совершение сделки покупки или продажи инструмента по определённой цене.
Заявка может быть адресной или безадресной.
Безадресные заявки — это обычный вид заявок, которые встают в очередь и видны всем пользователям, они обязательно участвуют в аукционе и сводятся со встречными заявками.
Если у заявки есть контрпредложение с ценой лучшей или равной цене заявки, то такие заявки сводятся в сделку с ценой равной цене заявки в контрпредложении.
Часть заявки, которая не свелась в сделку остается в виде заявки, с меньшим количеством инструмента.
Заявки бывают котировочные, встречные и заявки Fill-or-Kill.
Котировочная заявка остается в очереди независимо от того, свелась ли она частично, или не свелась совсем.
Встречная заявка, если она не свелась в сделку, удаляется из системы после проведения аукциона.
При частичном сведении встречной заявки, несведенная ее часть также удаляется.
Заявки Fill-or-Kill — это встречные заявки, которые предполагают только полное исполнение (сведение в сделку).

# Формирование сделки осуществляется следующим образом:
Поступила котировочная заявка на покупку
21.06.2018 10:28:05.294;21.06.2018 10:28:34.751;31251204957;64436;5;5;0;0;0;Add, Buy, Quote, EndOfTransaction
Поступает встречная заявка на продажу
21.06.2018 10:28:05.294;21.06.2018 10:28:34.751;31251204973;64436;1;1;0;0;0;Add, Sell, FillOrKill
Заявки сведены в сделку
21.06.2018 10:28:05.294;21.06.2018 10:28:34.751;31251204973;64436;1;0;2061560913;64436;1444866;Fill, Sell, FillOrKill
21.06.2018 10:28:05.294;21.06.2018 10:28:34.751;31251204957;64436;1;4;2061560913;64436;1444866;Fill, Buy, Quote, EndOfTransaction

# В файле нас интересуют строки с флагом Fill.
Последовательность поступления заявок определяется полем OrderId.
Чем больше значение OrderId тем ближе (младше) заявка.

